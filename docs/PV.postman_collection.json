{
  "info": {
    "_postman_id": "9ed706f6-c238-4420-93d8-7d67386a5eb6",
    "name": "PV API",
    "description": "Colecao para testar os endpoints expostos pelo servico FastAPI do projeto PV. Atualize as variaveis de ambiente do Postman conforme necessario.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health & Metrics",
      "description": "Verificacoes basicas de disponibilidade do servico.",
      "item": [
        {
          "name": "Metrics Feed",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/metrics",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "metrics"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Health Probe",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/v1/health",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "health"
            ]
          }
        },
          "response": []
        }
      ]
    },
    {
      "name": "Auth",
      "description": "Fluxo completo de autenticacao (login, refresh e logout).",
      "item": [
        {
          "name": "Login",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{userEmail}}\",\n  \"password\": \"{{userPassword}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/v1/t/{{tenantId}}/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "t",
                "{{tenantId}}",
                "login"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const data = pm.response.json();",
                  "  if (data.accessToken || data.access_token) {",
                  "    pm.environment.set(\"accessToken\", data.accessToken || data.access_token);",
                  "  }",
                  "  if (data.refreshToken || data.refresh_token) {",
                  "    pm.environment.set(\"refreshToken\", data.refreshToken || data.refresh_token);",
                  "  }",
                  "  if (data.expiresIn || data.expires_in) {",
                  "    pm.environment.set(\"accessTokenExpiresIn\", String(data.expiresIn || data.expires_in));",
                  "  }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Refresh Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/v1/t/{{tenantId}}/refresh",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "t",
                "{{tenantId}}",
                "refresh"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const data = pm.response.json();",
                  "  if (data.accessToken || data.access_token) {",
                  "    pm.environment.set(\"accessToken\", data.accessToken || data.access_token);",
                  "  }",
                  "  if (data.expiresIn || data.expires_in) {",
                  "    pm.environment.set(\"accessTokenExpiresIn\", String(data.expiresIn || data.expires_in));",
                  "  }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/v1/t/{{tenantId}}/logout",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "t",
                "{{tenantId}}",
                "logout"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Simulations",
      "description": "Calculo de metricas de simulacao de fluxo de pagamentos.",
      "auth": {
        "type": "bearer",
        "bearer": [
          {
            "key": "token",
            "value": "{{accessToken}}",
            "type": "string"
          }
        ]
      },
      "item": [
        {
          "name": "Create Simulation",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"plans\": [\n    {\n      \"key\": \"plan-1\",\n      \"label\": \"Exemplo com Reajuste INCC + 1%\",\n      \"principal\": 360000,\n      \"discount_rate\": 0.01,\n      \"adjustment\": {\n        \"base_date\": \"2024-01-01\",\n        \"index\": \"INCC\",\n        \"periodicity\": \"monthly\",\n        \"addon_rate\": 0.01\n      },\n      \"installments\": [\n        {\n          \"due_date\": \"2024-02-15\",\n          \"amount\": 10000\n        },\n        {\n          \"due_date\": \"2024-03-15\",\n          \"amount\": 10000\n        },\n        {\n          \"due_date\": \"2024-04-15\",\n          \"amount\": 10000\n        }\n      ]\n    },\n    {\n      \"key\": \"plan-2\",\n      \"label\": \"Exemplo sem Reajuste\",\n      \"principal\": 50000,\n      \"discount_rate\": 0.015,\n      \"installments\": [\n        {\n          \"due_date\": \"2024-02-20\",\n          \"amount\": 25000\n        },\n        {\n          \"due_date\": \"2024-03-20\",\n          \"amount\": 25000\n        }\n      ]\n    }\n  ]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/v1/t/{{tenantId}}/simulations/batches",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "t",
                "{{tenantId}}",
                "simulations",
                "batches"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Valuations",
      "description": "Validacao de cenarios de carteira e calculo de metricas de valuation.",
      "auth": {
        "type": "bearer",
        "bearer": [
          {
            "key": "token",
            "value": "{{accessToken}}",
            "type": "string"
          }
        ]
      },
      "item": [
        {
          "name": "Create Valuation",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"cashflows\": [\n    {\n      \"due_date\": \"2025-01-15\",\n      \"amount\": 15000,\n      \"probability_default\": 0.05,\n      \"probability_cancellation\": 0.02\n    },\n    {\n      \"due_date\": \"2025-02-15\",\n      \"amount\": 15000,\n      \"probability_default\": 0.04,\n      \"probability_cancellation\": 0.02\n    }\n  ],\n  \"scenarios\": [\n    {\n      \"code\": \"BASE\",\n      \"discount_rate\": 0.08,\n      \"default_multiplier\": 1.0,\n      \"cancellation_multiplier\": 1.0\n    },\n    {\n      \"code\": \"STRESS\",\n      \"discount_rate\": 0.1,\n      \"default_multiplier\": 1.3,\n      \"cancellation_multiplier\": 1.1\n    }\n  ]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/v1/t/{{tenantId}}/valuations",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "t",
                "{{tenantId}}",
                "valuations"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Benchmarking",
      "description": "Ingestao e consulta de dados agregados de benchmarking.",
      "auth": {
        "type": "bearer",
        "bearer": [
          {
            "key": "token",
            "value": "{{accessToken}}",
            "type": "string"
          }
        ]
      },
      "item": [
        {
          "name": "Ingest Benchmark Dataset",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": "/path/to/your/dataset.csv"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/v1/t/{{tenantId}}/benchmarking/batches/{{batchId}}/ingest",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "t",
                "{{tenantId}}",
                "benchmarking",
                "batches",
                "{{batchId}}",
                "ingest"
              ]
            }
          },
          "response": []
        },
        {
          "name": "List Benchmark Aggregations",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/v1/t/{{tenantId}}/benchmarking/batches/{{batchId}}/aggregations",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "t",
                "{{tenantId}}",
                "benchmarking",
                "batches",
                "{{batchId}}",
                "aggregations"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Financial Indexes",
      "description": "Cadastro e consulta de valores para índices financeiros customizados por tenant.",
      "auth": {
        "type": "bearer",
        "bearer": [
          {
            "key": "token",
            "value": "{{accessToken}}",
            "type": "string"
          }
        ]
      },
      "item": [
        {
          "name": "Create or Update Index Values",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"values\": [\n    {\n      \"reference_date\": \"2024-01-01\",\n      \"value\": 1.005\n    },\n    {\n      \"reference_date\": \"2024-02-01\",\n      \"value\": 1.0045\n    }\n  ]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/v1/t/{{tenantId}}/indexes/INCC-CUSTOM/values",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "t",
                "{{tenantId}}",
                "indexes",
                "INCC-CUSTOM",
                "values"
              ]
            }
          },
          "response": []
        },
        {
          "name": "List Index Values",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/v1/t/{{tenantId}}/indexes/INCC-CUSTOM/values",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "t",
                "{{tenantId}}",
                "indexes",
                "INCC-CUSTOM",
                "values"
              ]
            }
          },
          "response": []
        }
      ]
    }
    {
      "name": "Administration",
      "description": "Endpoints para administração de tenants, planos e usuários. Requer privilégios de superadmin.",
      "auth": {
        "type": "bearer",
        "bearer": [
          {
            "key": "token",
            "value": "{{accessToken}}",
            "type": "string"
          }
        ]
      },
      "item": [
        {
          "name": "Create Commercial Plan",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Plano Básico\",\n  \"description\": \"Acesso essencial às funcionalidades.\",\n  \"maxUsers\": 10,\n  \"billingCycleMonths\": 1\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/v1/admin/plans",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "admin",
                "plans"
              ]
            }
          },
          "response": []
        },
        {
          "name": "List Tenants",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/v1/admin/tenants?include_inactive=true",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "admin",
                "tenants"
              ],
              "query": [
                {
                  "key": "include_inactive",
                  "value": "true"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Create Tenant",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Novo Cliente\",\n  \"slug\": \"novo-cliente\",\n  \"planId\": \"{{planId}}\",\n  \"companies\": [\n    {\n      \"legalName\": \"Novo Cliente LTDA\",\n      \"taxId\": \"00111222000133\",\n      \"billingEmail\": \"financeiro@novocliente.com\",\n      \"addressLine1\": \"Av. Principal, 1\",\n      \"city\": \"Rio de Janeiro\",\n      \"state\": \"RJ\",\n      \"zipCode\": \"20000-000\",\n      \"country\": \"BR\"\n    }\n  ],\n  \"administrators\": [\n    {\n      \"email\": \"admin@novocliente.com\",\n      \"password\": \"SenhaForte123!\",\n      \"fullName\": \"Admin do Cliente\",\n      \"roles\": [\"tenant_admin\"]\n    }\n  ]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/v1/admin/tenants",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "admin",
                "tenants"
              ]
            }
          },
          "response": []
        },
        {
          "name": "List Tenant Users",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/v1/t/{{tenantId}}/admin/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "t",
                "{{tenantId}}",
                "admin",
                "users"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Create Tenant User",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"analista@novocliente.com\",\n    \"password\": \"SenhaForte123!\",\n    \"fullName\": \"Analista Financeiro\",\n    \"roles\": [\"user\"]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/v1/t/{{tenantId}}/admin/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "t",
                "{{tenantId}}",
                "admin",
                "users"
              ]
            }
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "https://api.hostname_I_will_choose.com",
      "type": "string",
      "description": "Host de producao"
    },
    {
      "key": "tenantId",
      "value": "11111111-1111-1111-1111-111111111111",
      "type": "string"
    },
    {
      "key": "snapshotId",
      "value": "snapshot-001",
      "type": "string"
    },
    {
      "key": "batchId",
      "value": "00000000-0000-0000-0000-000000000001",
      "type": "string"
    },
    {
      "key": "benchmarkFilename",
      "value": "dataset.csv",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "refreshToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "accessTokenExpiresIn",
      "value": "",
      "type": "string"
    },
    {
      "key": "userEmail",
      "value": "admin@example.com",
      "type": "string"
    },
    {
      "key": "userPassword",
      "value": "changeme",
      "type": "string"
    },
    {
      "key": "homologBaseUrl",
      "value": "https://api-homolog.hostname_i_will_choose.com",
      "type": "string",
      "description": "Host de homologacao (copie para baseUrl no ambiente de homologacao)"
    }
  ]
}
